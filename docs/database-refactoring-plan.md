# データベースリファクタリング計画

## 概要
採用管理システムのデータベーススキーマをより実用的で保守しやすい設計に改善するためのリファクタリング計画です。

## 修正内容

### 1. 応募者テーブル（applicants）の修正

#### 学歴の分割
**変更前：**
```sql
education             VARCHAR(100)   NOT NULL          │ -- 最終学歴
```

**変更後：**
```sql
school_name           VARCHAR(100)   NOT NULL          │ -- 学校名
faculty               VARCHAR(100)                      │ -- 学部
department            VARCHAR(100)                      │ -- 学科・コース
```

**理由：**
- 検索・フィルタリングが容易になる（例：「東京大学」で検索）
- 統計分析が可能（例：学部別の応募者数）
- データの正規化ができる

#### 住所の分割
**変更前：**
```sql
address               TEXT                             │ -- 住所
```

**変更後：**
```sql
current_address       TEXT                             │ -- 現住所
hometown_address      TEXT                             │ -- 帰省先住所
```

**理由：**
- 緊急連絡先として帰省先住所が必要
- 遠隔地の応募者への配慮
- データの用途が明確に分かれる

### 2. 選考履歴テーブル（selection_histories）の修正

#### 開始日時の削除
**削除項目：**
```sql
start_date            TIMESTAMP      NOT NULL          │ -- 開始日時
```

**理由：**
- 選考履歴の作成日時 = その段階の開始日時
- データの重複を避けられる
- シンプルな設計になる

#### 選考状況と選考結果の統合
**変更前：**
```sql
status                ENUM           NOT NULL          │ -- 選考状況
result                ENUM                             │ -- 選考結果
```

**変更後：**
```sql
status                ENUM           NOT NULL          │ -- 選考状況・結果
```

**理由：**
- 実際の運用では「完了」=「合格」の場合が多い
- シンプルな設計になる
- データの重複を避けられる

### 3. 固定タスクテーブル（fixed_tasks）の修正

#### 必須フラグの削除
**削除項目：**
```sql
is_required           BOOLEAN        NOT NULL          │ -- 必須フラグ
```

**理由：**
- 必須タスクと任意タスクの区別が不要
- シンプルな設計になる

#### 推定所要時間の削除
**削除項目：**
```sql
estimated_duration    INT            NOT NULL          │ -- 推定所要時間（分）
```

**理由：**
- タスクの工数見積もりが不要
- シンプルな設計になる

### 4. タスクインスタンステーブル（task_instances）の修正

#### 連絡状況の削除
**削除項目：**
```sql
contact_status        ENUM                             │ -- 連絡状況
```

**理由：**
- タスクの状況（status）で十分表現できる
- データの重複を避けられる

#### 開始日時の削除
**削除項目：**
```sql
started_at            TIMESTAMP                        │ -- 開始日時
```

**理由：**
- タスクの開始は即座に行われるため、`created_at`で十分
- データの重複を避けられる

### 5. イベントテーブル（events）の修正

#### 開始・終了日時の削除
**削除項目：**
```sql
start_date            TIMESTAMP      NOT NULL          │ -- 開始日時
end_date              TIMESTAMP      NOT NULL          │ -- 終了日時
```

**理由：**
- セッションで開始・終了日時を管理するため
- データの重複を避けられる
- シンプルな設計になる

## 修正後のメリット

1. **シンプルな設計**: 不要な項目を削除し、保守性が向上
2. **データの正規化**: 学歴・住所の分割により検索・分析が容易
3. **一貫性の向上**: 重複する情報を削除し、データの整合性が向上
4. **運用の簡素化**: 入力項目が減り、ユーザビリティが向上

## 影響範囲

### フロントエンド
- 応募者フォームの修正（学歴・住所フィールドの分割）
- 選考履歴表示の修正
- タスク管理画面の修正
- イベント管理画面の修正

### バックエンド
- APIエンドポイントの修正
- データベースマイグレーション
- バリデーションロジックの修正

### データ移行
- 既存データの移行スクリプト作成
- データ整合性の確認

## 実装順序

1. データベースマイグレーションの作成
2. バックエンドAPIの修正
3. フロントエンドコンポーネントの修正
4. データ移行の実行
5. テストの実行

## 注意事項

- 既存データの移行時にデータロスが発生しないよう注意
- フロントエンドとバックエンドの同期を保つ
- 段階的なデプロイメントを検討
- ロールバック計画の準備
